#!/bin/sh

opts='r'
. lib/cmd.sh
. lib/color.sh
. lib/file.sh

rainbow=0
while true; do
    case "$1" in
    -r) rainbow=1; shift;;
    --) shift; break;;
    esac
done

message=`echo "$*" | sed -E 's/(.*) >>.*/\1/'`
raw_file=`echo "$*" | sed -nE 's/.* >>(.*)/\1/p'`

if [ $rainbow = 1 ]; then
    message=`color_rainbow "$message"`
fi

if [ -n "$raw_file" ]; then
    echo "$message" >> `file_chan $chan "$raw_file"`
else
    privmsg $chan "$message"
fi
